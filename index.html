<fieldset class="js-goseigen-secretsofgrindea">
    <legend>goseigen-secretsofgrindea</legend>
    <div>
        <div>
            <label>
                <span>Signs</span>
                <input autofocus value="+x+-" class="js-signs">
            </label>
            <span>Ex.: +x+-</span>
        </div>

        <div>
            <label>
                <span>Numbers</span>
                <input value="74291" type="number" class="js-numbers">
            </label>
            <span>Ex.: 74291</span>
        </div>

        <div>
            <label>
                <span>Expected answer</span>
                <input value="41" type="number" class="js-expected-answer">
            </label>
            <span>Ex.: 41</span>
        </div>

        <div>
            <label>
                <span>Output</span>
                <pre class="js-output"></pre>
            </label>
        </div>

        <div>
            <button class="js-solve">Solve</button>
        </div>
    </div>
</fieldset>

<script>
-function () {
    var $form = document.querySelector('.js-goseigen-secretsofgrindea')
    var $signs = $form.querySelector('.js-signs')
    var $numbers = $form.querySelector('.js-numbers')
    var $expectedAnswer = $form.querySelector('.js-expected-answer')
    var $solve = $form.querySelector('.js-solve')
    var $output = $form.querySelector('.js-output')

    $solve.addEventListener('click', function () {
        $output.textContent = 'Solving...'

        setTimeout(function () {
            var answers = mod.goseigenSecretsofgrindea.solve(
                $signs.value,
                $numbers.value,
                parseInt($expectedAnswer.value)
            )

            $output.textContent = 'Total = ' + answers.length + '\n'

            for (var i = 0; i < answers.length; i++) {
                var answer = answers[i]
                $output.textContent += answer.gameAnswer.replace(/(\D)/g, ' $1 ') + '\n'
            }
        }, 10)
    })
}()
</script>

<script>
var mod = {}

mod.goseigenSecretsofgrindea = (function () {
    var mod = {}

    mod.interpolation = function (syms) {
        var inter = []

        if (syms.length < 3) {
            inter.push(syms[0] + syms[1])
            inter.push(syms[1] + syms[0])
        } else {
            for (var i = 0; i < syms.length; i++) {
                var slice = syms.slice(0, i).concat(syms.slice(i + 1))
                var inter2 = mod.interpolation(slice)
                for (var j = 0; j < inter2.length; j++) {
                    inter.push(syms[i] + inter2[j])
                }
            }
        }

        return inter
    }

    mod.solve = function (signs, nums, ans) {
        if (!('string' === typeof(signs) && signs.length > 0)) return false
        if (!('string' === typeof(nums) && nums.length > 0)) return false
        if (!(Number.isFinite(ans) && ans === ~~ans)) return false
        if (!(signs.length + 1 === nums.length)) return false

        signs = signs.split('')
        var areAllValidSigns = signs.every(function (sign) {
            return sign === 'x' || sign === '+' || sign === '-'
        })
        if (!areAllValidSigns) return false
        signs = signs.map(function (sign) { return sign === 'x' ? '*' : sign })

        nums = nums.split('')
        var areAllValidNums = nums.every(function (num) {
            return num === '1' || num === '2' || num === '3' || num === '4' || num === '5' || num === '6' || num === '7' || num === '8' || num === '9'
        })
        if (!areAllValidNums) return false

        var uniqueAnswers = {}
        var answers = []

        if (signs.length === 1) {
            answers.push(nums[0] + signs[0] + nums[1])
            answers.push(nums[1] + signs[0] + nums[0])
        } else {
            var uniqueSi = {}
            var signsInterpolation = mod.interpolation(signs)
            for (var i = 0; i < signsInterpolation.length; i++) {
                uniqueSi[signsInterpolation[i]] = 1
            }
            signsInterpolation = Object.keys(uniqueSi)

            var uniqueNums = {}
            var numsInterpolation = mod.interpolation(nums)
            for (var i = 0; i < numsInterpolation.length; i++) {
                uniqueNums[numsInterpolation[i]] = 1
            }
            numsInterpolation = Object.keys(uniqueNums)

            for (var i = 0; i < numsInterpolation.length; i++) {
                for (var j = 0; j < numsInterpolation[i].length; j++) {
                    for (var k = 0; k < signsInterpolation.length; k++) {
                        var answer = ''

                        answer += '('.repeat(signsInterpolation[k].length)

                        for (var l = 0; l < signsInterpolation[k].length; l++) {
                            answer += numsInterpolation[i][l]
                            answer += ')'
                            answer += signsInterpolation[k][l].replace('x', '*')
                        }

                        answer += numsInterpolation[i][numsInterpolation[i].length - 1]
                        answers.push(answer)
                    }
                }
            }
        }

        for (var i = 0; i < answers.length; i++) {
            try {
                if (eval(answers[i] + '===' + ans)) {
                    uniqueAnswers[answers[i]] = 1
                } else {
                    answers.splice(i, 1)
                    i--
                }
            } catch (e) {}
        }

        return Object.keys(uniqueAnswers).map(function (answer) {
            var gameAnswer = answer.replace(/[()]/g, '')
            return {
                jsAnswer: answer,
                gameAnswer: gameAnswer,
            }
        })
    }

    mod.isNodejs = function () {
        return typeof module !== 'undefined'
    }

    mod.getCliArgs = function () {
        if (mod.isNodejs()) {
            return process.argv.slice(2)
        } else {
            return []
        }
    }

    mod.main = function () {
        var args = mod.getCliArgs()
        var signs = args[0]
        var nums = args[1]
        var expectedAnswer = parseInt(args[2])

        console.log('SIGNS', signs)
        console.log('NUMS', nums)
        console.log('EXPECTED ANSWER', expectedAnswer)

        var answers = mod.solve(signs, nums, expectedAnswer)
        if (Array.isArray(answers)) {
            console.log('ANSWERS', answers.length)
            for (var i = 0; i < answers.length; i++) {
                var math = answers[i].gameAnswer.replace(/(\D)/g, ' $1 ')
                console.log(i + 1, math + ' = ' + expectedAnswer)
            }
        } else {
            console.log('ERROR CALCULATING ANSWER')
        }
    }

    if (mod.getCliArgs().length > 0) {
        mod.main()
    } else {
        console.log('Usage:')
        console.log('  node app.js <SIGNS> <NUMBERS> <EXP_ANSWER>')
        console.log('Example: node app.js +x++ 74291 41')
        console.log('Example: node app.js xx+- 23232 16')
    }

    if (mod.isNodejs()) {
        module.exports = mod
    } else {
        return mod
    }
}())
</script>
